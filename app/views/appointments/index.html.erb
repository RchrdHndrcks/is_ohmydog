<!DOCTYPE html>
<html>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>

  <%= javascript_include_tag 'application' %>
  <%= stylesheet_link_tag 'application' %>
  <%= stylesheet_link_tag 'https://cdn.jsdelivr.net/npm/flatpickr@4.6.6/dist/flatpickr.min.css' %>
  <%= javascript_include_tag 'https://cdn.jsdelivr.net/npm/flatpickr@4.6.6/dist/flatpickr.min.js' %>
  <!-- Otras inclusiones -->
</head>

</head>

<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #ffffff; /* Fondo blanco */
    color: #333; /* Color de texto principal */
  }

  table {
    width: 80%;
    border-collapse: collapse;
    margin: 20px auto; /* Centra horizontalmente */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  

  th, td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #ddd; /* Línea divisoria */
    vertical-align: middle;
  }

  th {
    position: relative;
    background-color: #2596be;
    margin: 0 auto;
    padding: 20px;
    max-width: 1000px;
    margin-bottom: 35px;
  }

  tr:nth-child(even) {
    background-color: #f2f2f2; /* Fondo de filas pares */
  }

  .highlight1 {
    background-color: #f8934f;
    color: #ffffff;
  }

  .highlight2 {
    background-color: #2596be;
    color: #ffffff;
      }
    </style>

      <h1 style="text-align: center;">Turnos en Espera</h1>
      <table>
        <thead>
          <tr>
            <th>Franja Horaria</th>
            <th>Perros</th>
            <% if current_user.es_admin? %>
          <th>Correo</th>
          <th>Acciones</th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @appointments_en_espera.each do |appointment| %>
        <tr>
          <td><%= appointment.timeSlot %></td>
          <td>
            <ul>
              <% appointment.dogs.each do |dog| %>
                <li><%= dog.name %></li>
              <% end %>
            </ul>
          </td>
          <% if current_user.es_admin? %>
            <td><%= User.find(appointment.user_id).email %></td>
            <td>
              <%= form_with(model: appointment, url: update_date_appointment_path(appointment), method: :patch, remote: true) do |f| %>
                <%= f.date_field :appointment_date, id: "appointment_date", class: "button", placeholder: "Elegir fecha" %>
                <%= f.submit "Confirmar", class: "button", id: "confirmButton" %>
              <% end %>
            </td>
            <td>  
            <%= form_with(model: appointment, url: update_state_appointment_path(appointment), method: :patch, remote: true) do |f| %>
              <%= f.hidden_field :state, value: "rechazado" %>
              <%= f.submit "Rechazar", class: "button", id: "rechazar-btn" %>
            <% end %>

            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <h1 style="text-align: center;">Proximos turnos</h1>
  <table>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Perros</th>
        <% if current_user.es_admin? %>
          <th>Correo</th>
        <% end %>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <% @appointments_aceptados.each do |appointment| %>
        <tr>
          <td><%= appointment.appointment_date %></td>
          <td>
            <ul>
              <% appointment.dogs.each do |dog| %>
                <li><%= dog.name %></li>
              <% end %>
            </ul>
          </td>
          <% if current_user.es_admin? %>
            <td><%= User.find(appointment.user_id).email %></td>
          <% end %>
          <td>
            <%= form_with(model: appointment, url: update_state_appointment_path(appointment), method: :patch, remote: true) do |f| %>
              <%= f.hidden_field :state, value: "cancelado" %>
              <%= f.submit "Cancelar", class: "button", id: "cancelar-btn" %>
            <% end %>
          </td> 
        </tr>
      <% end %>
    </tbody>
  </table>

  <h1 style="text-align: center;">Turnos Rechazados</h1>
  <table>
    <thead>
      <tr>
        <th>Perros</th> 
        <th>Franja</th>
        <% if current_user.es_admin? %>
        <th>Correo</th>
      <% end %>
      </tr>
    </thead>
    <tbody>
      <% @appointments_rechazados.each do |appointment| %>
        <tr>
          <td>
            <ul>
              <% appointment.dogs.each do |dog| %>
                <li><%= dog.name %></li>
              <% end %>
            </ul>
          </td>
          <td><%= appointment.timeSlot %></td>
          <% if current_user.es_admin? %>
            <td><%= User.find(appointment.user_id).email %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<!-- esta funcion no esta en la hu, descomentar si el cliente quiere ver los turnos canceladors
  <h1 style="text-align: center;">Turnos Cancelados</h1>
  <table>
    <thead> 
      <tr> 
        <th>Perros</th>
        <th>Franja</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody>
      <% @appointments_cancelados.each do |appointment| %>
        <tr>
          <td>
            <ul>
              <% appointment.dogs.each do |dog| %>
                <li><%= dog.name %></li>
              <% end %>
            </ul>
          </td>
          <td><%= appointment.timeSlot %></td>
          <td><%= appointment.appointment_date %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
-->           

        

</html>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var rechazarBtn = document.getElementById("rechazar-btn");

    rechazarBtn.addEventListener("click", function(event) {
      // Muestra un mensaje de confirmación al usuario
      if (!confirm("¿Estás seguro de que quieres rechazar la cita?")) {
        // Si el usuario cancela, evita enviar el formulario
        event.preventDefault();
      }
    });
  });
  
  document.addEventListener("DOMContentLoaded", function() {
    var cancelarBtn = document.getElementById("cancelar-btn");

    cancelarBtn.addEventListener("click", function(event) {
      // Muestra un mensaje de confirmación al usuario
      if (!confirm("¿Estás seguro de que quieres cancelar la cita?")) {
        // Si el usuario cancela, evita enviar el formulario
        event.preventDefault();
      }else{
        alert("Se ha eliminado el turno");
      }
    });
  });

  document.addEventListener("DOMContentLoaded", function() {
    var confirmBtn = document.getElementById("confirmButton");

    confirmBtn.addEventListener("click", function(event) {
      // Muestra un mensaje de confirmación al usuario
      if (!confirm("¿Estás seguro de que quieres confirmar la cita?")) {
        // Si el usuario cancela, evita enviar el formulario
        event.preventDefault();
      }

    });
  });

</script>

<script>


  flatpickr("#appointment_date", {
    enableTime: true, 
    dateFormat: "Y-m-d H:i",
    minDate: "today",
    
    disable: [
      function(date) {
        // return true to disable
        return (date.getDay() === 0 || date.getDay() === 6);

      }
    ],
    locale: {
      firstDayOfWeek: 1 // start week on Monday
    }
  });


  
  

</script>
